syntax = "proto3";
package pos.timelock.v1;

option go_package = "pos/x/timelock/types";

import "google/protobuf/any.proto";
import "cosmos_proto/cosmos.proto";
import "amino/amino.proto";
import "gogoproto/gogo.proto";

// OperationStatus represents the current state of a queued operation
enum OperationStatus {
  // OPERATION_STATUS_UNSPECIFIED is the default value
  OPERATION_STATUS_UNSPECIFIED = 0;

  // OPERATION_STATUS_QUEUED means the operation is waiting for delay to pass
  OPERATION_STATUS_QUEUED = 1;

  // OPERATION_STATUS_EXECUTED means the operation has been successfully executed
  OPERATION_STATUS_EXECUTED = 2;

  // OPERATION_STATUS_CANCELLED means the operation was cancelled by guardian
  OPERATION_STATUS_CANCELLED = 3;

  // OPERATION_STATUS_EXPIRED means the grace period has passed without execution
  OPERATION_STATUS_EXPIRED = 4;

  // OPERATION_STATUS_FAILED means execution was attempted but failed
  OPERATION_STATUS_FAILED = 5;
}

// Params defines the parameters for the timelock module
message Params {
  option (amino.name) = "pos/timelock/Params";
  option (gogoproto.equal) = true;

  // min_delay_seconds is the minimum time between queueing and execution in seconds (default: 86400 = 24h)
  uint64 min_delay_seconds = 1;

  // max_delay_seconds is the maximum allowed delay in seconds (default: 1209600 = 14d)
  uint64 max_delay_seconds = 2;

  // grace_period_seconds is the window after min_delay during which execution is valid (default: 604800 = 7d)
  uint64 grace_period_seconds = 3;

  // emergency_delay_seconds is the reduced delay for emergency operations in seconds (min: 3600 = 1h)
  uint64 emergency_delay_seconds = 4;

  // guardian is the address authorized to cancel operations and emergency execute
  string guardian = 5 [(cosmos_proto.scalar) = "cosmos.AddressString"];
}

// QueuedOperation represents an operation waiting for execution
message QueuedOperation {
  // id is the unique identifier for this operation
  uint64 id = 1;

  // proposal_id is the governance proposal that created this operation
  uint64 proposal_id = 2;

  // messages are the sdk.Msg objects to execute
  repeated google.protobuf.Any messages = 3;

  // operation_hash is the cryptographic hash of the operation for verification
  bytes operation_hash = 4;

  // queued_at_unix is when the operation was queued (Unix timestamp seconds)
  int64 queued_at_unix = 5;

  // executable_at_unix is the earliest time the operation can be executed (Unix timestamp seconds)
  int64 executable_at_unix = 6;

  // expires_at_unix is the latest time the operation can be executed (Unix timestamp seconds)
  int64 expires_at_unix = 7;

  // status is the current state of the operation
  OperationStatus status = 8;

  // executor is the address authorized to execute this operation
  string executor = 9 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // executed_at_unix is when the operation was executed (Unix timestamp seconds, 0 if not executed)
  int64 executed_at_unix = 10;

  // cancelled_at_unix is when the operation was cancelled (Unix timestamp seconds, 0 if not cancelled)
  int64 cancelled_at_unix = 11;

  // cancel_reason is the reason for cancellation (if applicable)
  string cancel_reason = 12;

  // execution_error is the error message if execution failed
  string execution_error = 13;
}

// GenesisState defines the timelock module's genesis state
message GenesisState {
  // params are the module parameters
  Params params = 1 [(gogoproto.nullable) = false, (amino.dont_omitempty) = true];

  // operations are all queued operations
  repeated QueuedOperation operations = 2 [(gogoproto.nullable) = false];

  // next_operation_id is the next available operation ID
  uint64 next_operation_id = 3;
}
